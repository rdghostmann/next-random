
import { revalidatePath } from "next/cache";

export async function scrapeRandomNumbers(url:string) {
    try {
        const browser = await puppeteer.launch({headless: false});
        const page = await browser.newPage();
        const navigationPromise = page.waitForNavigation({
            waitUntil: "networkidle0",
            timeout: 120000,
        });

        await page.goto(url, {waitUntil: "networkidle0", timeout: 120000});
        await page.addScriptTag({
            url: "https://code.jquery.com/jquery-3.7.0.min.js"
        });
        await navigationPromise;

        const isJqueryLoaded = await page.evaluate(()=> !window?.jQuery);
        if(!isJqueryLoaded){
            throw new Error("jQuery not loaded");
        }

        const data = await page.evaluate(()=> {
            const generatedNumber:any = $("pre.data").text().trim();
            return generatedNumber;
        })

        await browser.close();
        revalidatePath('/');
        return {...data, url};
    } catch (error) {
        console.log(error);
        return null;
        
    }
}